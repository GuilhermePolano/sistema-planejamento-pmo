<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste da Aplica√ß√£o - PMO FIERGS</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
        }
        .test-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            border-left: 4px solid #667eea;
        }
        .success { border-left-color: #28a745; }
        .error { border-left-color: #dc3545; }
        .info { border-left-color: #17a2b8; }
        .warning { border-left-color: #ffc107; }
        button {
            padding: 12px 20px;
            margin: 8px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }
        .btn-success { background: linear-gradient(135deg, #28a745 0%, #20c997 100%); }
        .btn-warning { background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%); }
        .btn-danger { background: linear-gradient(135deg, #dc3545 0%, #e83e8c 100%); }
        .btn-info { background: linear-gradient(135deg, #17a2b8 0%, #6f42c1 100%); }
        pre {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 12px;
            color: #f8f9fa;
            max-height: 300px;
            overflow-y: auto;
        }
        .status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }
        .status.success { background: #28a745; }
        .status.error { background: #dc3545; }
        .status.info { background: #17a2b8; }
        .status.warning { background: #ffc107; color: #000; }
        .links {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 20px 0;
        }
        .link-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            text-decoration: none;
            color: white;
            transition: all 0.3s ease;
        }
        .link-card:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .test-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            border-left: 4px solid #667eea;
        }
        .test-card.success { border-left-color: #28a745; }
        .test-card.error { border-left-color: #dc3545; }
        .test-card.info { border-left-color: #17a2b8; }
        .test-card.warning { border-left-color: #ffc107; }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            transition: width 0.3s ease;
        }
        .mongodb-icon {
            color: #00ed64;
            font-size: 1.2em;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Teste da Aplica√ß√£o - PMO FIERGS</h1>
        <p>Verificando se todos os componentes est√£o funcionando corretamente, incluindo integra√ß√µes MongoDB.</p>
        
        <div class="links">
            <a href="http://localhost:3000" class="link-card" target="_blank">
                üìä Dashboard Principal
            </a>
            <a href="http://localhost:3000/upload" class="link-card" target="_blank">
                üì§ Upload de Arquivos
            </a>
            <a href="http://localhost:3000/planejamento-semanal.html" class="link-card" target="_blank">
                üìÖ Planejamento Semanal
            </a>
            <a href="http://localhost:3000/test-routes.html" class="link-card" target="_blank">
                üîß Teste de Rotas API
            </a>
        </div>
    </div>

    <div class="container">
        <h2>üóÑÔ∏è Testes de Integra√ß√£o MongoDB</h2>
        
        <div class="test-section">
            <h3><span class="mongodb-icon">‚ö°</span> 1. Status da Conex√£o MongoDB</h3>
            <button onclick="testMongoDBConnection()" class="btn-info">Verificar Conex√£o MongoDB</button>
            <div id="mongodb-connection-status">Aguardando teste...</div>
        </div>

        <div class="test-section">
            <h3><span class="mongodb-icon">üìä</span> 2. Teste das APIs MongoDB</h3>
            <button onclick="testMongoDBAPIs()" class="btn-info">Testar APIs MongoDB</button>
            <div id="mongodb-apis-status">Aguardando teste...</div>
        </div>

        <div class="test-section">
            <h3><span class="mongodb-icon">üìã</span> 3. Teste de Dados das Cole√ß√µes</h3>
            <button onclick="testMongoDBCollections()" class="btn-info">Verificar Cole√ß√µes</button>
            <div id="mongodb-collections-status">Aguardando teste...</div>
        </div>

        <div class="test-section">
            <h3><span class="mongodb-icon">üîÑ</span> 4. Teste de Fallback JSON</h3>
            <button onclick="testJSONFallback()" class="btn-warning">Testar Fallback JSON</button>
            <div id="json-fallback-status">Aguardando teste...</div>
        </div>

        <div class="test-section">
            <h3><span class="mongodb-icon">üì§</span> 5. Teste de Upload para MongoDB</h3>
            <button onclick="testMongoDBUpload()" class="btn-success">Testar Upload MongoDB</button>
            <div id="mongodb-upload-status">Aguardando teste...</div>
        </div>
    </div>

    <div class="container">
        <h2>üîç Testes de Funcionalidade Geral</h2>
        
        <div class="test-section">
            <h3>1. Status do Servidor</h3>
            <button onclick="testServerStatus()">Verificar Servidor</button>
            <div id="server-status">Aguardando teste...</div>
        </div>

        <div class="test-section">
            <h3>2. Teste de Rotas da API</h3>
            <button onclick="testAPIRoutes()">Testar Rotas API</button>
            <div id="api-status">Aguardando teste...</div>
        </div>

        <div class="test-section">
            <h3>3. Teste de Dados do Dashboard</h3>
            <button onclick="testDashboardData()">Carregar Dados</button>
            <div id="dashboard-status">Aguardando teste...</div>
        </div>

        <div class="test-section">
            <h3>4. Teste de Planejamento Semanal</h3>
            <button onclick="testPlanningAPI()">Testar Planejamento</button>
            <div id="planning-status">Aguardando teste...</div>
        </div>

        <div class="test-section">
            <h3>5. Teste de Upload de Arquivos</h3>
            <button onclick="testFileUpload()">Testar Upload</button>
            <div id="upload-status">Aguardando teste...</div>
        </div>
    </div>

    <div class="container">
        <h2>üìä Resumo dos Testes</h2>
        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
        </div>
        <div id="test-summary">
            <p>Aguardando execu√ß√£o dos testes...</p>
        </div>
    </div>

    <div class="container">
        <h2>üìã Logs de Teste</h2>
        <div id="test-logs" style="max-height: 400px; overflow-y: auto;">
            <p>Os logs de teste aparecer√£o aqui...</p>
        </div>
    </div>

    <script>
        let testResults = {
            mongodb: { passed: 0, total: 0 },
            general: { passed: 0, total: 0 }
        };

        function log(message, type = 'info') {
            const logsDiv = document.getElementById('test-logs');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `test-section ${type}`;
            logEntry.innerHTML = `
                <span class="status ${type}">${type.toUpperCase()}</span>
                <strong>[${timestamp}]</strong> ${message}
            `;
            logsDiv.insertBefore(logEntry, logsDiv.firstChild);
        }

        function updateProgress() {
            const totalTests = testResults.mongodb.total + testResults.general.total;
            const passedTests = testResults.mongodb.passed + testResults.general.passed;
            const percentage = totalTests > 0 ? (passedTests / totalTests) * 100 : 0;
            
            document.getElementById('progress-fill').style.width = `${percentage}%`;
            
            const summary = document.getElementById('test-summary');
            summary.innerHTML = `
                <div class="test-grid">
                    <div class="test-card ${testResults.mongodb.passed === testResults.mongodb.total ? 'success' : 'warning'}">
                        <h4>üóÑÔ∏è MongoDB Tests</h4>
                        <p>${testResults.mongodb.passed}/${testResults.mongodb.total} passed</p>
                    </div>
                    <div class="test-card ${testResults.general.passed === testResults.general.total ? 'success' : 'warning'}">
                        <h4>üîß General Tests</h4>
                        <p>${testResults.general.passed}/${testResults.general.total} passed</p>
                    </div>
                </div>
                <p><strong>Total: ${passedTests}/${totalTests} tests passed (${percentage.toFixed(1)}%)</strong></p>
            `;
        }

        function recordTestResult(category, passed) {
            testResults[category].total++;
            if (passed) testResults[category].passed++;
            updateProgress();
        }

        // MongoDB Integration Tests
        async function testMongoDBConnection() {
            const statusDiv = document.getElementById('mongodb-connection-status');
            statusDiv.innerHTML = '<p>Verificando conex√£o MongoDB...</p>';
            
            try {
                const response = await fetch('/api/check-mongodb');
                if (response.ok) {
                    const result = await response.json();
                    if (result.success) {
                        if (result.available) {
                            statusDiv.innerHTML = `
                                <p class="success">‚úÖ MongoDB conectado e funcionando!</p>
                                <p><strong>Status:</strong> ${result.status}</p>
                            `;
                            log('MongoDB conectado com sucesso', 'success');
                            recordTestResult('mongodb', true);
                        } else {
                            statusDiv.innerHTML = `
                                <p class="warning">‚ö†Ô∏è MongoDB n√£o dispon√≠vel (usando fallback JSON)</p>
                                <p><strong>Status:</strong> ${result.status}</p>
                            `;
                            log('MongoDB n√£o dispon√≠vel - usando fallback JSON', 'warning');
                            recordTestResult('mongodb', false);
                        }
                    } else {
                        statusDiv.innerHTML = `<p class="error">‚ùå Erro ao verificar MongoDB: ${result.error}</p>`;
                        log(`Erro ao verificar MongoDB: ${result.error}`, 'error');
                        recordTestResult('mongodb', false);
                    }
                } else {
                    statusDiv.innerHTML = `<p class="error">‚ùå Erro na API: ${response.status}</p>`;
                    log(`Erro na API de verifica√ß√£o MongoDB: ${response.status}`, 'error');
                    recordTestResult('mongodb', false);
                }
            } catch (error) {
                statusDiv.innerHTML = `<p class="error">‚ùå Erro de conex√£o: ${error.message}</p>`;
                log(`Erro de conex√£o MongoDB: ${error.message}`, 'error');
                recordTestResult('mongodb', false);
            }
        }

        async function testMongoDBAPIs() {
            const statusDiv = document.getElementById('mongodb-apis-status');
            statusDiv.innerHTML = '<p>Testando APIs MongoDB...</p>';
            
            const apis = [
                { name: 'Tarefas Analistas', url: '/api/tarefas-analistas' },
                { name: 'Analistas', url: '/api/analistas' },
                { name: 'Projetos', url: '/api/projetos' },
                { name: 'Categorias', url: '/api/categorias' },
                { name: 'Sustenta√ß√µes', url: '/api/sustentacoes' }
            ];
            
            let successCount = 0;
            let totalCount = apis.length;
            let results = [];
            
            for (const api of apis) {
                try {
                    const response = await fetch(api.url);
                    if (response.ok) {
                        const data = await response.json();
                        successCount++;
                        results.push(`‚úÖ ${api.name}: ${data.success ? 'OK' : 'Erro nos dados'}`);
                        log(`API ${api.name} funcionando`, 'success');
                    } else {
                        results.push(`‚ùå ${api.name}: Erro ${response.status}`);
                        log(`API ${api.name} com erro: ${response.status}`, 'error');
                    }
                } catch (error) {
                    results.push(`‚ùå ${api.name}: ${error.message}`);
                    log(`API ${api.name} com erro: ${error.message}`, 'error');
                }
            }
            
            statusDiv.innerHTML = `
                <p class="${successCount === totalCount ? 'success' : 'warning'}">
                    ${successCount === totalCount ? '‚úÖ' : '‚ö†Ô∏è'} ${successCount}/${totalCount} APIs funcionando
                </p>
                <pre>${results.join('\n')}</pre>
            `;
            
            recordTestResult('mongodb', successCount === totalCount);
        }

        async function testMongoDBCollections() {
            const statusDiv = document.getElementById('mongodb-collections-status');
            statusDiv.innerHTML = '<p>Verificando dados das cole√ß√µes...</p>';
            
            try {
                const [tarefasRes, analistasRes, projetosRes, categoriasRes, sustentacoesRes] = await Promise.all([
                    fetch('/api/tarefas-analistas'),
                    fetch('/api/analistas'),
                    fetch('/api/projetos'),
                    fetch('/api/categorias'),
                    fetch('/api/sustentacoes')
                ]);
                
                const [tarefasData, analistasData, projetosData, categoriasData, sustentacoesData] = await Promise.all([
                    tarefasRes.json(),
                    analistasRes.json(),
                    projetosRes.json(),
                    categoriasRes.json(),
                    sustentacoesRes.json()
                ]);
                
                const collections = [
                    { name: 'Tarefas', data: tarefasData, count: tarefasData.data?.length || 0 },
                    { name: 'Analistas', data: analistasData, count: analistasData.data?.length || 0 },
                    { name: 'Projetos', data: projetosData, count: projetosData.data?.length || 0 },
                    { name: 'Categorias', data: categoriasData, count: categoriasData.data?.length || 0 },
                    { name: 'Sustenta√ß√µes', data: sustentacoesData, count: sustentacoesData.data?.length || 0 }
                ];
                
                const totalItems = collections.reduce((sum, col) => sum + col.count, 0);
                const hasData = totalItems > 0;
                
                statusDiv.innerHTML = `
                    <p class="${hasData ? 'success' : 'info'}">
                        ${hasData ? '‚úÖ' : '‚ÑπÔ∏è'} Dados encontrados nas cole√ß√µes
                    </p>
                    <div class="test-grid">
                        ${collections.map(col => `
                            <div class="test-card ${col.count > 0 ? 'success' : 'info'}">
                                <h4>${col.name}</h4>
                                <p>${col.count} registros</p>
                            </div>
                        `).join('')}
                    </div>
                    <p><strong>Total: ${totalItems} registros</strong></p>
                `;
                
                log(`Verificadas ${collections.length} cole√ß√µes com ${totalItems} registros totais`, hasData ? 'success' : 'info');
                recordTestResult('mongodb', true);
                
            } catch (error) {
                statusDiv.innerHTML = `<p class="error">‚ùå Erro ao verificar cole√ß√µes: ${error.message}</p>`;
                log(`Erro ao verificar cole√ß√µes: ${error.message}`, 'error');
                recordTestResult('mongodb', false);
            }
        }

        async function testJSONFallback() {
            const statusDiv = document.getElementById('json-fallback-status');
            statusDiv.innerHTML = '<p>Testando fallback para JSON...</p>';
            
            try {
                // Primeiro verificar se MongoDB est√° dispon√≠vel
                const mongoResponse = await fetch('/api/check-mongodb');
                const mongoResult = await mongoResponse.json();
                
                if (mongoResult.available) {
                    statusDiv.innerHTML = `
                        <p class="info">‚ÑπÔ∏è MongoDB est√° dispon√≠vel - fallback JSON n√£o necess√°rio</p>
                        <p>Para testar o fallback, desative o MongoDB temporariamente</p>
                    `;
                    log('MongoDB dispon√≠vel - fallback n√£o testado', 'info');
                    recordTestResult('mongodb', true);
                } else {
                    // Testar se os dados JSON est√£o dispon√≠veis
                    const dashboardResponse = await fetch('/api/dashboard-data');
                    if (dashboardResponse.ok) {
                        const dashboardData = await dashboardResponse.json();
                        if (dashboardData.success && dashboardData.data) {
                            statusDiv.innerHTML = `
                                <p class="success">‚úÖ Fallback JSON funcionando!</p>
                                <p>Dados carregados do arquivo JSON local</p>
                            `;
                            log('Fallback JSON funcionando corretamente', 'success');
                            recordTestResult('mongodb', true);
                        } else {
                            statusDiv.innerHTML = '<p class="warning">‚ö†Ô∏è Fallback JSON dispon√≠vel mas sem dados</p>';
                            log('Fallback JSON sem dados', 'warning');
                            recordTestResult('mongodb', false);
                        }
                    } else {
                        statusDiv.innerHTML = `<p class="error">‚ùå Erro no fallback JSON: ${dashboardResponse.status}</p>`;
                        log(`Erro no fallback JSON: ${dashboardResponse.status}`, 'error');
                        recordTestResult('mongodb', false);
                    }
                }
            } catch (error) {
                statusDiv.innerHTML = `<p class="error">‚ùå Erro ao testar fallback: ${error.message}</p>`;
                log(`Erro ao testar fallback: ${error.message}`, 'error');
                recordTestResult('mongodb', false);
            }
        }

        async function testMongoDBUpload() {
            const statusDiv = document.getElementById('mongodb-upload-status');
            statusDiv.innerHTML = '<p>Testando funcionalidade de upload para MongoDB...</p>';
            
            try {
                // Verificar se a rota de upload est√° dispon√≠vel
                const response = await fetch('/upload');
                if (response.ok) {
                    statusDiv.innerHTML = `
                        <p class="success">‚úÖ P√°gina de upload dispon√≠vel!</p>
                        <p>Para testar o upload completo, use a p√°gina de upload com um arquivo Excel/CSV</p>
                        <p><strong>Nota:</strong> O upload salvar√° dados no MongoDB se dispon√≠vel, ou JSON como fallback</p>
                    `;
                    log('P√°gina de upload MongoDB funcionando', 'success');
                    recordTestResult('mongodb', true);
                } else {
                    statusDiv.innerHTML = `<p class="error">‚ùå Erro na p√°gina de upload: ${response.status}</p>`;
                    log(`Erro na p√°gina de upload: ${response.status}`, 'error');
                    recordTestResult('mongodb', false);
                }
            } catch (error) {
                statusDiv.innerHTML = `<p class="error">‚ùå Erro: ${error.message}</p>`;
                log(`Erro no teste de upload MongoDB: ${error.message}`, 'error');
                recordTestResult('mongodb', false);
            }
        }

        // General Functionality Tests
        async function testServerStatus() {
            const statusDiv = document.getElementById('server-status');
            statusDiv.innerHTML = '<p>Verificando servidor...</p>';
            
            try {
                const response = await fetch('/api/dashboard-data');
                if (response.ok) {
                    statusDiv.innerHTML = '<p class="success">‚úÖ Servidor funcionando corretamente!</p>';
                    log('Servidor respondendo corretamente', 'success');
                    recordTestResult('general', true);
                } else {
                    statusDiv.innerHTML = `<p class="error">‚ùå Erro no servidor: ${response.status}</p>`;
                    log(`Erro no servidor: ${response.status}`, 'error');
                    recordTestResult('general', false);
                }
            } catch (error) {
                statusDiv.innerHTML = `<p class="error">‚ùå Erro de conex√£o: ${error.message}</p>`;
                log(`Erro de conex√£o: ${error.message}`, 'error');
                recordTestResult('general', false);
            }
        }

        async function testAPIRoutes() {
            const statusDiv = document.getElementById('api-status');
            statusDiv.innerHTML = '<p>Testando rotas da API...</p>';
            
            const routes = [
                { name: 'Dashboard Data', url: '/api/dashboard-data' },
                { name: 'Projetos', url: '/api/projetos' },
                { name: 'Analistas', url: '/api/analistas' },
                { name: 'Tarefas', url: '/api/tarefas' },
                { name: 'Planejamento', url: '/api/planejamento?dataInicio=2025-08-11&numSemanas=4' }
            ];
            
            let successCount = 0;
            let totalCount = routes.length;
            
            for (const route of routes) {
                try {
                    const response = await fetch(route.url);
                    if (response.ok || response.status === 404) {
                        successCount++;
                        log(`‚úÖ Rota ${route.name}: OK`, 'success');
                    } else {
                        log(`‚ùå Rota ${route.name}: Erro ${response.status}`, 'error');
                    }
                } catch (error) {
                    log(`‚ùå Rota ${route.name}: ${error.message}`, 'error');
                }
            }
            
            if (successCount === totalCount) {
                statusDiv.innerHTML = '<p class="success">‚úÖ Todas as rotas da API est√£o funcionando!</p>';
            } else {
                statusDiv.innerHTML = `<p class="error">‚ùå ${successCount}/${totalCount} rotas funcionando</p>`;
            }
            
            recordTestResult('general', successCount === totalCount);
        }

        async function testDashboardData() {
            const statusDiv = document.getElementById('dashboard-status');
            statusDiv.innerHTML = '<p>Carregando dados do dashboard...</p>';
            
            try {
                const response = await fetch('/api/dashboard-data');
                if (response.ok) {
                    const data = await response.json();
                    if (data.success && data.data) {
                        const stats = data.data;
                        statusDiv.innerHTML = `
                            <p class="success">‚úÖ Dados carregados com sucesso!</p>
                            <p><strong>Estat√≠sticas:</strong></p>
                            <ul>
                                <li>Projetos: ${stats.projetos?.length || 0}</li>
                                <li>Analistas: ${stats.analistas?.length || 0}</li>
                                <li>Tarefas: ${stats.tarefas?.length || 0}</li>
                            </ul>
                        `;
                        log('Dados do dashboard carregados com sucesso', 'success');
                        recordTestResult('general', true);
                    } else {
                        statusDiv.innerHTML = '<p class="info">‚ÑπÔ∏è Nenhum dado encontrado (normal se n√£o processou arquivo ainda)</p>';
                        log('Nenhum dado encontrado no dashboard', 'info');
                        recordTestResult('general', true);
                    }
                } else {
                    statusDiv.innerHTML = `<p class="error">‚ùå Erro ao carregar dados: ${response.status}</p>`;
                    log(`Erro ao carregar dados: ${response.status}`, 'error');
                    recordTestResult('general', false);
                }
            } catch (error) {
                statusDiv.innerHTML = `<p class="error">‚ùå Erro: ${error.message}</p>`;
                log(`Erro ao carregar dados: ${error.message}`, 'error');
                recordTestResult('general', false);
            }
        }

        async function testPlanningAPI() {
            const statusDiv = document.getElementById('planning-status');
            statusDiv.innerHTML = '<p>Testando API de planejamento...</p>';
            
            try {
                // Testar busca de planejamento com data que sabemos que existe
                const dataInicio = '2025-08-11';
                
                const response = await fetch(`/api/planejamento?dataInicio=${dataInicio}&numSemanas=4`);
                
                if (response.ok) {
                    const data = await response.json();
                    statusDiv.innerHTML = `
                        <p class="success">‚úÖ API de planejamento funcionando!</p>
                        <p><strong>Planejamento encontrado para ${dataInicio}:</strong></p>
                        <p>ID: ${data.id}</p>
                        <p>Per√≠odo: ${new Date(data.dataInicio).toLocaleDateString()} a ${new Date(data.dataFim).toLocaleDateString()}</p>
                        <p>Semanas: ${data.semanas?.length || 0}</p>
                    `;
                    log('API de planejamento funcionando corretamente', 'success');
                    recordTestResult('general', true);
                } else if (response.status === 404) {
                    statusDiv.innerHTML = '<p class="info">‚ÑπÔ∏è API funcionando (404 √© normal se n√£o h√° planejamento criado)</p>';
                    log('API de planejamento funcionando (sem dados)', 'info');
                    recordTestResult('general', true);
                } else {
                    statusDiv.innerHTML = `<p class="error">‚ùå Erro na API: ${response.status}</p>`;
                    log(`Erro na API de planejamento: ${response.status}`, 'error');
                    recordTestResult('general', false);
                }
            } catch (error) {
                statusDiv.innerHTML = `<p class="error">‚ùå Erro: ${error.message}</p>`;
                log(`Erro na API de planejamento: ${error.message}`, 'error');
                recordTestResult('general', false);
            }
        }

        async function testFileUpload() {
            const statusDiv = document.getElementById('upload-status');
            statusDiv.innerHTML = '<p>Testando funcionalidade de upload...</p>';
            
            try {
                // Verificar se a rota de upload est√° dispon√≠vel
                const response = await fetch('/upload');
                if (response.ok) {
                    statusDiv.innerHTML = '<p class="success">‚úÖ P√°gina de upload dispon√≠vel!</p>';
                    log('P√°gina de upload funcionando', 'success');
                    recordTestResult('general', true);
                } else {
                    statusDiv.innerHTML = `<p class="error">‚ùå Erro na p√°gina de upload: ${response.status}</p>`;
                    log(`Erro na p√°gina de upload: ${response.status}`, 'error');
                    recordTestResult('general', false);
                }
            } catch (error) {
                statusDiv.innerHTML = `<p class="error">‚ùå Erro: ${error.message}</p>`;
                log(`Erro no teste de upload: ${error.message}`, 'error');
                recordTestResult('general', false);
            }
        }

        // Executar testes automaticamente ao carregar a p√°gina
        window.onload = function() {
            log('Iniciando testes da aplica√ß√£o...', 'info');
            
            // MongoDB Tests
            setTimeout(() => testMongoDBConnection(), 1000);
            setTimeout(() => testMongoDBAPIs(), 2000);
            setTimeout(() => testMongoDBCollections(), 3000);
            setTimeout(() => testJSONFallback(), 4000);
            setTimeout(() => testMongoDBUpload(), 5000);
            
            // General Tests
            setTimeout(() => testServerStatus(), 6000);
            setTimeout(() => testAPIRoutes(), 7000);
            setTimeout(() => testDashboardData(), 8000);
            setTimeout(() => testPlanningAPI(), 9000);
            setTimeout(() => testFileUpload(), 10000);
        };
    </script>
</body>
</html>
