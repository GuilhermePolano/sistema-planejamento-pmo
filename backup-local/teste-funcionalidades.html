<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Funcionalidades - Planejamento Semanal</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            padding: 20px;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e9ecef;
            border-radius: 10px;
        }
        
        .test-title {
            color: #667eea;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .test-result {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .test-success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .test-error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .test-info {
            background-color: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        
        .btn-test {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 25px;
            padding: 10px 25px;
            color: white;
            font-weight: 500;
            margin: 5px;
        }
        
        .btn-test:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            color: white;
        }
        
        .data-display {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="text-center mb-4">
            <h1><i class="fas fa-vial me-2"></i>Teste de Funcionalidades</h1>
            <p class="text-muted">Verificação completa das funcionalidades do Planejamento Semanal</p>
        </div>

        <!-- Teste 1: Status do Servidor -->
        <div class="test-section">
            <h3 class="test-title"><i class="fas fa-server me-2"></i>1. Status do Servidor</h3>
            <div id="server-status" class="test-info">
                <strong>Status:</strong> Verificando...
            </div>
            <button class="btn btn-test" onclick="testarServidor()">
                <i class="fas fa-play me-1"></i>Testar Servidor
            </button>
        </div>

        <!-- Teste 2: API de Dados -->
        <div class="test-section">
            <h3 class="test-title"><i class="fas fa-database me-2"></i>2. API de Dados</h3>
            <div id="api-status" class="test-info">
                <strong>Status:</strong> Aguardando teste...
            </div>
            <div id="api-data" class="data-display" style="display: none;"></div>
            <button class="btn btn-test" onclick="testarAPI()">
                <i class="fas fa-play me-1"></i>Testar API
            </button>
        </div>

        <!-- Teste 3: Carregamento de Dados -->
        <div class="test-section">
            <h3 class="test-title"><i class="fas fa-download me-2"></i>3. Carregamento de Dados</h3>
            <div id="data-loading-status" class="test-info">
                <strong>Status:</strong> Aguardando teste...
            </div>
            <div id="data-summary" class="data-display" style="display: none;"></div>
            <button class="btn btn-test" onclick="testarCarregamentoDados()">
                <i class="fas fa-play me-1"></i>Testar Carregamento
            </button>
        </div>

        <!-- Teste 4: Processamento de Dados -->
        <div class="test-section">
            <h3 class="test-title"><i class="fas fa-cogs me-2"></i>4. Processamento de Dados</h3>
            <div id="processing-status" class="test-info">
                <strong>Status:</strong> Aguardando teste...
            </div>
            <div id="processing-results" class="data-display" style="display: none;"></div>
            <button class="btn btn-test" onclick="testarProcessamento()">
                <i class="fas fa-play me-1"></i>Testar Processamento
            </button>
        </div>

        <!-- Teste 5: Funcionalidades JavaScript -->
        <div class="test-section">
            <h3 class="test-title"><i class="fas fa-code me-2"></i>5. Funcionalidades JavaScript</h3>
            <div id="js-status" class="test-info">
                <strong>Status:</strong> Aguardando teste...
            </div>
            <button class="btn btn-test" onclick="testarJavaScript()">
                <i class="fas fa-play me-1"></i>Testar JavaScript
            </button>
        </div>

        <!-- Teste 6: Links de Acesso -->
        <div class="test-section">
            <h3 class="test-title"><i class="fas fa-link me-2"></i>6. Links de Acesso</h3>
            <div class="row">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Aplicação Principal</h5>
                            <a href="http://localhost:3000" target="_blank" class="btn btn-primary">
                                <i class="fas fa-home me-1"></i>Dashboard
                            </a>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Planejamento Semanal</h5>
                            <a href="http://localhost:3000/planejamento-semanal.html" target="_blank" class="btn btn-success">
                                <i class="fas fa-calendar me-1"></i>Planejamento
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Resumo dos Testes -->
        <div class="test-section">
            <h3 class="test-title"><i class="fas fa-clipboard-check me-2"></i>Resumo dos Testes</h3>
            <div id="test-summary" class="test-info">
                <strong>Status Geral:</strong> Aguardando execução dos testes...
            </div>
            <button class="btn btn-test" onclick="executarTodosTestes()">
                <i class="fas fa-play me-1"></i>Executar Todos os Testes
            </button>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        let resultadosTestes = {};

        // Teste 1: Status do Servidor
        async function testarServidor() {
            const statusDiv = document.getElementById('server-status');
            statusDiv.innerHTML = '<strong>Status:</strong> Testando...';
            statusDiv.className = 'test-info';

            try {
                const response = await fetch('http://localhost:3000');
                if (response.ok) {
                    statusDiv.innerHTML = '<strong>Status:</strong> ✅ Servidor funcionando corretamente na porta 3000';
                    statusDiv.className = 'test-success';
                    resultadosTestes.servidor = 'SUCCESS';
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                statusDiv.innerHTML = `<strong>Status:</strong> ❌ Erro ao conectar com servidor: ${error.message}`;
                statusDiv.className = 'test-error';
                resultadosTestes.servidor = 'ERROR';
            }
        }

        // Teste 2: API de Dados
        async function testarAPI() {
            const statusDiv = document.getElementById('api-status');
            const dataDiv = document.getElementById('api-data');
            
            statusDiv.innerHTML = '<strong>Status:</strong> Testando...';
            statusDiv.className = 'test-info';

            try {
                const response = await fetch('http://localhost:3000/data/dashboard-data.json');
                if (response.ok) {
                    const data = await response.json();
                    
                    statusDiv.innerHTML = '<strong>Status:</strong> ✅ API de dados funcionando corretamente';
                    statusDiv.className = 'test-success';
                    
                    dataDiv.style.display = 'block';
                    dataDiv.innerHTML = `
                        <strong>Dados carregados:</strong><br>
                        - Projetos: ${data.projetos ? data.projetos.length : 0}<br>
                        - Tamanho do arquivo: ${JSON.stringify(data).length} caracteres<br>
                        - Timestamp: ${new Date().toLocaleString('pt-BR')}
                    `;
                    
                    resultadosTestes.api = 'SUCCESS';
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                statusDiv.innerHTML = `<strong>Status:</strong> ❌ Erro na API: ${error.message}`;
                statusDiv.className = 'test-error';
                resultadosTestes.api = 'ERROR';
            }
        }

        // Teste 3: Carregamento de Dados
        async function testarCarregamentoDados() {
            const statusDiv = document.getElementById('data-loading-status');
            const summaryDiv = document.getElementById('data-summary');
            
            statusDiv.innerHTML = '<strong>Status:</strong> Testando...';
            statusDiv.className = 'test-info';

            try {
                const response = await fetch('http://localhost:3000/data/dashboard-data.json');
                if (response.ok) {
                    const dados = await response.json();
                    
                    // Simular processamento de dados
                    const tarefas = processarTarefas(dados);
                    const analistas = processarAnalistas(dados);
                    const projetos = dados.projetos || [];
                    
                    statusDiv.innerHTML = '<strong>Status:</strong> ✅ Carregamento de dados funcionando';
                    statusDiv.className = 'test-success';
                    
                    summaryDiv.style.display = 'block';
                    summaryDiv.innerHTML = `
                        <strong>Resumo dos dados processados:</strong><br>
                        - Tarefas extraídas: ${tarefas.length}<br>
                        - Analistas únicos: ${analistas.length}<br>
                        - Projetos: ${projetos.length}<br>
                        - Primeira tarefa: ${tarefas.length > 0 ? tarefas[0].titulo : 'N/A'}<br>
                        - Primeiro analista: ${analistas.length > 0 ? analistas[0].nome : 'N/A'}
                    `;
                    
                    resultadosTestes.carregamento = 'SUCCESS';
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                statusDiv.innerHTML = `<strong>Status:</strong> ❌ Erro no carregamento: ${error.message}`;
                statusDiv.className = 'test-error';
                resultadosTestes.carregamento = 'ERROR';
            }
        }

        // Teste 4: Processamento de Dados
        async function testarProcessamento() {
            const statusDiv = document.getElementById('processing-status');
            const resultsDiv = document.getElementById('processing-results');
            
            statusDiv.innerHTML = '<strong>Status:</strong> Testando...';
            statusDiv.className = 'test-info';

            try {
                const response = await fetch('http://localhost:3000/data/dashboard-data.json');
                if (response.ok) {
                    const dados = await response.json();
                    
                    // Testar funções de processamento
                    const tarefas = processarTarefas(dados);
                    const analistas = processarAnalistas(dados);
                    
                    // Testar cálculo de capacidade
                    const capacidadeTeste = calcularCapacidadeTeste(analistas, tarefas);
                    
                    statusDiv.innerHTML = '<strong>Status:</strong> ✅ Processamento de dados funcionando';
                    statusDiv.className = 'test-success';
                    
                    resultsDiv.style.display = 'block';
                    resultsDiv.innerHTML = `
                        <strong>Resultados do processamento:</strong><br>
                        - Tarefas processadas: ${tarefas.length}<br>
                        - Analistas processados: ${analistas.length}<br>
                        - Capacidade calculada: ${capacidadeTeste.totalHoras}h<br>
                        - Média de utilização: ${capacidadeTeste.mediaUtilizacao.toFixed(1)}%
                    `;
                    
                    resultadosTestes.processamento = 'SUCCESS';
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                statusDiv.innerHTML = `<strong>Status:</strong> ❌ Erro no processamento: ${error.message}`;
                statusDiv.className = 'test-error';
                resultadosTestes.processamento = 'ERROR';
            }
        }

        // Teste 5: Funcionalidades JavaScript
        function testarJavaScript() {
            const statusDiv = document.getElementById('js-status');
            statusDiv.innerHTML = '<strong>Status:</strong> Testando...';
            statusDiv.className = 'test-info';

            try {
                // Testar se as funções estão disponíveis
                const funcoesTeste = [
                    'processarTarefas',
                    'processarAnalistas',
                    'calcularHoras',
                    'getCorTarefa',
                    'getProgressBarClass'
                ];

                const funcoesDisponiveis = funcoesTeste.filter(funcao => typeof window[funcao] === 'function');
                
                if (funcoesDisponiveis.length === funcoesTeste.length) {
                    statusDiv.innerHTML = '<strong>Status:</strong> ✅ Funções JavaScript disponíveis';
                    statusDiv.className = 'test-success';
                    resultadosTestes.javascript = 'SUCCESS';
                } else {
                    throw new Error(`Funções faltando: ${funcoesTeste.filter(f => !funcoesDisponiveis.includes(f)).join(', ')}`);
                }
            } catch (error) {
                statusDiv.innerHTML = `<strong>Status:</strong> ❌ Erro no JavaScript: ${error.message}`;
                statusDiv.className = 'test-error';
                resultadosTestes.javascript = 'ERROR';
            }
        }

        // Funções auxiliares para os testes
        function processarTarefas(dados) {
            const tarefas = [];
            
            if (dados.projetos) {
                dados.projetos.forEach(projeto => {
                    if (projeto.tarefasDetalhadas) {
                        projeto.tarefasDetalhadas.forEach(tarefa => {
                            tarefas.push({
                                id: `task_${projeto.nome}_${tarefa.titulo}`,
                                titulo: tarefa.titulo,
                                analista: tarefa.analista,
                                projeto: projeto.nome,
                                tipo: 'projeto',
                                dataInicio: tarefa.inicio + 'T09:00:00',
                                dataFim: tarefa.fim + 'T17:00:00',
                                horas: calcularHoras(tarefa.inicio, tarefa.fim),
                                descricao: `Tarefa do projeto ${projeto.nome}`,
                                status: tarefa.status
                            });
                        });
                    }
                });
            }
            
            return tarefas;
        }

        function processarAnalistas(dados) {
            const analistasUnicos = new Set();
            
            if (dados.projetos) {
                dados.projetos.forEach(projeto => {
                    if (projeto.analistas) {
                        projeto.analistas.forEach(analista => {
                            analistasUnicos.add(analista);
                        });
                    }
                });
            }
            
            return Array.from(analistasUnicos).map(nome => ({
                nome: nome,
                capacidade: 100
            }));
        }

        function calcularHoras(dataInicio, dataFim) {
            const inicio = new Date(dataInicio);
            const fim = new Date(dataFim);
            const diffTime = Math.abs(fim - inicio);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            return diffDays * 8;
        }

        function getCorTarefa(tipo) {
            const cores = {
                'projeto': '#28a745',
                'sustentacao': '#ffc107',
                'interno': '#17a2b8'
            };
            return cores[tipo] || '#667eea';
        }

        function getProgressBarClass(utilizacao) {
            if (utilizacao >= 90) return 'bg-danger';
            if (utilizacao >= 75) return 'bg-warning';
            if (utilizacao >= 50) return 'bg-info';
            return 'bg-success';
        }

        function calcularCapacidadeTeste(analistas, tarefas) {
            const totalHoras = tarefas.reduce((total, tarefa) => total + (tarefa.horas || 0), 0);
            const mediaUtilizacao = analistas.length > 0 ? 
                analistas.reduce((total, analista) => total + (analista.capacidade || 100), 0) / analistas.length : 0;
            
            return {
                totalHoras,
                mediaUtilizacao
            };
        }

        // Executar todos os testes
        async function executarTodosTestes() {
            console.log('🧪 Iniciando todos os testes...');
            
            await testarServidor();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testarAPI();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testarCarregamentoDados();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testarProcessamento();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            testarJavaScript();
            
            // Atualizar resumo
            setTimeout(atualizarResumo, 500);
        }

        function atualizarResumo() {
            const summaryDiv = document.getElementById('test-summary');
            const totalTestes = Object.keys(resultadosTestes).length;
            const testesSucesso = Object.values(resultadosTestes).filter(r => r === 'SUCCESS').length;
            const testesErro = Object.values(resultadosTestes).filter(r => r === 'ERROR').length;
            
            if (testesErro === 0) {
                summaryDiv.innerHTML = `<strong>Status Geral:</strong> ✅ Todos os ${totalTestes} testes passaram com sucesso!`;
                summaryDiv.className = 'test-success';
            } else {
                summaryDiv.innerHTML = `<strong>Status Geral:</strong> ⚠️ ${testesSucesso}/${totalTestes} testes passaram, ${testesErro} falharam`;
                summaryDiv.className = 'test-error';
            }
        }

        // Executar testes automáticos ao carregar a página
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 Iniciando testes automáticos...');
            setTimeout(executarTodosTestes, 1000);
        });
    </script>
</body>
</html>
